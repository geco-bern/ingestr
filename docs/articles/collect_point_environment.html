<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Collect point-scale climate and soil information • ingestr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,300;0,400;0,700;1,300;1,400&amp;display=swap" rel="stylesheet">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- geco --><link href="../geco.css" rel="stylesheet">
<meta property="og:title" content="Collect point-scale climate and soil information">
<meta property="og:description" content="ingestr">
<meta name="twitter:card" content="summary">
<!-- Mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js" async integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/config/TeX-AMS-MML_HTMLorMML.js" async integrity="sha256-4zys9A4hMQmtq2EUL+JRoXc0NZi8jVJMzb8onewOaSQ=" crossorigin="anonymous"></script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">

    <div class="navbar-header">

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="external-link hidden-sm hidden-xs" href="https://geco-group.org/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_white_small.png" id="hexlogo" alt="GECO"></a>
        <a class="external-link hidden-md hidden-lg" href="https://geco-group.org/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_white_small.png" id="hexlogo" alt="GECO"></a>
        <a class="navbar-brand" href="../index.html">
           <i>ingestr <small>v1.4.1</small></i>
        </a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calc_daytime_vpd.html">Derived fluxnet variables</a>
    </li>
    <li>
      <a href="../articles/collect_point_environment.html">Collect point-scale climate and soil information</a>
    </li>
    <li>
      <a href="../articles/example.html">ingestr example</a>
    </li>
    <li>
      <a href="../articles/get_drivers_coordinates.html">Ingest P-model drivers from coordinates</a>
    </li>
    <li>
      <a href="../articles/get_evi_gee.html">Getting MODIS EVI data from Google Earth Engine</a>
    </li>
    <li>
      <a href="../articles/ingest_cru_rsofun.html">ingest CRU</a>
    </li>
    <li>
      <a href="../articles/modis_interpolation.html">Interpolation of MODIS data</a>
    </li>
    <li>
      <a href="../articles/run_pmodel_points.html">Run the P-model for point simulations</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/geco-bern/ingestr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Collect point-scale climate and soil
information</h1>
                        <h4 data-toc-skip class="author">Beni
Stocker</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/geco-bern/ingestr/blob/HEAD/vignettes/collect_point_environment.Rmd" class="external-link"><code>vignettes/collect_point_environment.Rmd</code></a></small>
      <div class="hidden name"><code>collect_point_environment.Rmd</code></div>

    </div>

    
    
<p>The package <em>ingestr</em> makes data collection for geographic
locations easy and reproducible. This vignette provides an example for
collecting climate and soil information for a set of variables which may
be considered in analyses of environment-vegetation relationships.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/geco-bern/ingestr" class="external-link">ingestr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>The only information required for running point simulations with the
P-model is the geographic position of the sites and their elevation. A
site name is required as an ID for the output. The site meta information
has to be provided as a data frame containing the following columns:
<code>sitename, lon, lat, elv</code>.</p>
<p>Let’s use the FLUXNET2015 site info data frame from ingestr as an
example here.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sites</span> <span class="op">&lt;-</span> <span class="va">siteinfo_fluxnet2015</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sitename</span>, <span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span></span>
<span><span class="va">df_sites</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">##   sitename   lon   lat</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> AR-SLu   -<span style="color: #BB0000;">66.5</span> -<span style="color: #BB0000;">33.5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> AR-Vir   -<span style="color: #BB0000;">56.2</span> -<span style="color: #BB0000;">28.2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> AT-Neu    11.3  47.1</span></span></code></pre>
<div class="section level2">
<h2 id="topography">Topography<a class="anchor" aria-label="anchor" href="#topography"></a>
</h2>
<div class="section level3">
<h3 id="elevation">Elevation<a class="anchor" aria-label="anchor" href="#elevation"></a>
</h3>
<p>Often, elevation is provided in datasets. If not, missing data can be
obtained by using the geographic location of each point and extracting
elevation data from a global digital elevation model, here ETOPO-1,
obtained through ingestr.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_etopo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">df_sites</span>,</span>
<span>  source <span class="op">=</span> <span class="st">"etopo1"</span>,</span>
<span>  dir <span class="op">=</span> <span class="st">"~/data/etopo/"</span>  <span class="co"># adjust this with your local path</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>  <span class="co"># to get a flat table</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if</span></span>
<span><span class="co">## `.name_repair` is omitted as of tibble 2.0.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Using compatibility `.name_repair`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">ingestr</span> package.</span></span>
<span><span class="co">##   Please report the issue at <span style="color: #0000BB; font-style: italic;">&lt;</span></span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_etopo</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   sitename [3]</span></span></span>
<span><span class="co">##   sitename   elv</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> AR-SLu     499</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> AR-Vir      97</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> AT-Neu    <span style="text-decoration: underline;">1</span>083</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="climate">Climate<a class="anchor" aria-label="anchor" href="#climate"></a>
</h2>
<p>ingestr makes it easy to collect WorldClim data from files available
locally (in directory <code>~/data/worldclim</code>). WorldClim provides
monthly climatologies of different meteorological variables, Here, we
collect them and aggregate them over the thermal growing season, i.e.,
over months where the growth temperature is above 0 deg C, and convert
them to units and variables as used also for inputs to the P-model (see
<a href="">here</a>). This includes the following (non-trivial)
calculations:</p>
<ul>
<li>Conversion of vapour pressure to the vapour pressure deficit (VPD).
To get daily values, we calculate the VPD for the daily minimum and
maximum temperature and then take the arithmetic mean across the two VPD
values to get a value, taken to be representative for daytime
conditions. This is done due to the strong non-linearity of VPD
(actually, the saturation vapour pressure) as a function of temperature.
The calculation is implemented by <code><a href="../reference/calc_vpd.html">ingestr::calc_vpd()</a></code> (see
code below).</li>
<li>Calculation of the growth temperature. See
<code><a href="../reference/calc_tgrowth.html">?ingestr::calc_tgrowth</a></code>.</li>
</ul>
<div class="section level3">
<h3 id="collect-worldclim-data">Collect WorldClim data<a class="anchor" aria-label="anchor" href="#collect-worldclim-data"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_wc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>varnam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tmin"</span>, <span class="st">"tmax"</span>, <span class="st">"vapr"</span>, <span class="st">"srad"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_wc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">df_sites</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"worldclim"</span>,</span>
<span>  settings  <span class="op">=</span> <span class="va">settings_wc</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"~/data/worldclim"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">df_wc</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   sitename [3]</span></span></span>
<span><span class="co">##   sitename data             </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> AR-SLu   <span style="color: #949494;">&lt;tibble [12 × 5]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> AR-Vir   <span style="color: #949494;">&lt;tibble [12 × 5]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> AT-Neu   <span style="color: #949494;">&lt;tibble [12 × 5]&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="units-and-aggregation">Units and aggregation<a class="anchor" aria-label="anchor" href="#units-and-aggregation"></a>
</h3>
<p>Next, we aggregate the monthly WorldClim climatology to means across
the thermal growing season, i.e., over months where the growth
temperature is above 0 deg C. Before aggregation, we also convert
WorldClim variables to the units required for <code>rpmodel</code>. See
<code>?rpmodel</code> for information about the arguments.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_growingseasonmean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tgrowth</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tgrowth</span>, <span class="va">vpd</span>, <span class="va">ppfd</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">kfFEC</span> <span class="op">&lt;-</span> <span class="fl">2.04</span></span>
<span></span>
<span><span class="va">df_wc</span> <span class="op">&lt;-</span> <span class="va">df_wc</span> <span class="op">|&gt;</span> </span>
<span>  </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span></span>
<span>  <span class="co">## add latitude</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_sites</span>, by <span class="op">=</span> <span class="st">"sitename"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  </span>
<span>  <span class="co">## vapour pressure kPa -&gt; Pa</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>vapr <span class="op">=</span> <span class="va">vapr</span> <span class="op">*</span> <span class="fl">1e3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  </span>
<span>  <span class="co">## PPFD from solar radiation: kJ m-2 day-1 -&gt; mol m−2 s−1 PAR</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ppfd <span class="op">=</span> <span class="fl">1e3</span> <span class="op">*</span> <span class="va">srad</span> <span class="op">*</span> <span class="va">kfFEC</span> <span class="op">*</span> <span class="fl">1.0e-6</span> <span class="op">/</span> <span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">24</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="co">## calculate VPD (Pa) based on tmin and tmax</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>vpd <span class="op">=</span> <span class="fu">ingestr</span><span class="fu">::</span><span class="fu"><a href="../reference/calc_vpd.html">calc_vpd</a></span><span class="op">(</span>eact <span class="op">=</span> <span class="va">vapr</span>, tmin <span class="op">=</span> <span class="va">tmin</span>, tmax <span class="op">=</span> <span class="va">tmax</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  </span>
<span>  <span class="co">## calculate growth temperature (average daytime temperature)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>doy <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">yday</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2001-01-15"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="va">month</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tgrowth <span class="op">=</span> <span class="fu">ingestr</span><span class="fu">::</span><span class="fu"><a href="../reference/calc_tgrowth.html">calc_tgrowth</a></span><span class="op">(</span><span class="va">tmin</span>, <span class="va">tmax</span>, <span class="va">lat</span>, <span class="va">doy</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  </span>
<span>  <span class="co">## average over growing season (where Tgrowth &gt; 0 deg C)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sitename</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>data_growingseason <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu">get_growingseasonmean</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data_growingseason</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_wc</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   sitename [3]</span></span></span>
<span><span class="co">##   sitename tgrowth   vpd     ppfd</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> AR-SLu     20.2  <span style="text-decoration: underline;">1</span>190. 0.000<span style="text-decoration: underline;">409</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> AR-Vir     21.7   872. 0.000<span style="text-decoration: underline;">379</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> AT-Neu      8.97  366. 0.000<span style="text-decoration: underline;">280</span></span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="soil">Soil<a class="anchor" aria-label="anchor" href="#soil"></a>
</h2>
<div class="section level3">
<h3 id="cn">C:N<a class="anchor" aria-label="anchor" href="#cn"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_wise</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_settings_wise.html">get_settings_wise</a></span><span class="op">(</span>varnam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CNrt"</span><span class="op">)</span>, layer <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_wise</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">df_sites</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"wise"</span>,</span>
<span>  settings  <span class="op">=</span> <span class="va">settings_wise</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"~/data/soil/wise"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">299957</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">51</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span>  (6): NEWSUID, CLAF, PRID, Drain, Layer, PSCL</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (45): SCID, PROP, DrainNum, TopDep, BotDep, CFRAG, CFRAG_std, SDTO, SDTO...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wise</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   sitename [3]</span></span></span>
<span><span class="co">##   sitename data            </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> AT-Neu   <span style="color: #949494;">&lt;tibble [1 × 1]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> AR-SLu   <span style="color: #949494;">&lt;tibble [1 × 1]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> AR-Vir   <span style="color: #949494;">&lt;tibble [1 × 1]&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="ph">pH<a class="anchor" aria-label="anchor" href="#ph"></a>
</h3>
<p>Can be obtained from HWSD. How to use rhwsd package? Not as
documented in ingestr <a href="https://geco-bern.github.io/ingestr/articles/example.html#hwsd-1" class="external-link">link</a>?</p>
</div>
</div>
<div class="section level2">
<h2 id="nutrient-inputs">Nutrient inputs<a class="anchor" aria-label="anchor" href="#nutrient-inputs"></a>
</h2>
<div class="section level3">
<h3 id="atmospheric-n-deposition">Atmospheric N deposition<a class="anchor" aria-label="anchor" href="#atmospheric-n-deposition"></a>
</h3>
<p>This requires start and end years to be specified. Let’s get data
from 1990 to 2009 and then calculate the mean annual total.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ndep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span></span>
<span>  <span class="va">df_sites</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year_start <span class="op">=</span> <span class="fl">1990</span>, year_end <span class="op">=</span> <span class="fl">2009</span><span class="op">)</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">"ndep"</span>,</span>
<span>  timescale <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  dir       <span class="op">=</span> <span class="st">"~/data/ndep_lamarque/"</span>,</span>
<span>  verbose   <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sitename</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>noy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">noy</span><span class="op">)</span>, nhx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">nhx</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ndep <span class="op">=</span> <span class="va">noy</span> <span class="op">+</span> <span class="va">nhx</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">noy</span>, <span class="op">-</span><span class="va">nhx</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required namespace: ncdf4</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ndep</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">##   sitename  ndep</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> AR-SLu   0.303</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> AR-Vir   0.636</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> AT-Neu   1.42</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="combine-data">Combine data<a class="anchor" aria-label="anchor" href="#combine-data"></a>
</h2>
<p>Let’s combine the data frames collected above into a single data
frame. Make sure that all data frames use the same unique identifier as
the column named <code>sitename</code>. Make all data frames flat before
(<code><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest()</a></code>) and avoid duplicate columns in joined data
frames.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df_sites</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_etopo</span>, </span>
<span>            by <span class="op">=</span> <span class="st">"sitename"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_wc</span>,</span>
<span>            by <span class="op">=</span> <span class="st">"sitename"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_ndep</span>, by <span class="op">=</span> <span class="st">"sitename"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_wise</span> <span class="op">|&gt;</span> </span>
<span>              <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, </span>
<span>            by <span class="op">=</span> <span class="st">"sitename"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 9</span></span></span>
<span><span class="co">##   sitename   lon   lat   elv tgrowth   vpd     ppfd  ndep  CNrt</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> AR-SLu   -<span style="color: #BB0000;">66.5</span> -<span style="color: #BB0000;">33.5</span>   499   20.2  <span style="text-decoration: underline;">1</span>190. 0.000<span style="text-decoration: underline;">409</span> 0.303  9.37</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> AR-Vir   -<span style="color: #BB0000;">56.2</span> -<span style="color: #BB0000;">28.2</span>    97   21.7   872. 0.000<span style="text-decoration: underline;">379</span> 0.636  9.2 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> AT-Neu    11.3  47.1  <span style="text-decoration: underline;">1</span>083    8.97  366. 0.000<span style="text-decoration: underline;">280</span> 1.42  12.8</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/geco-bern" target="_blank" class="external-link">
                          <div class="icon fab fa-github"></div></a>
                        <a href="https://geco-group.org" target="_blank" class="external-link">
                          <div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/SteniBocker/" target="_blank" class="external-link">
                          <div class="icon fab fa-twitter"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://geco-group.org/" class="external-link">GECO</a></li>
                            <li><a href="https://geco-group.org/people/" class="external-link">Our Team</a></li>
                            <li><a href="https://geco-group.org/contact/" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://github.com/geco-bern" class="external-link">Packages</a></li>
                            <li><a href="https://geco-group.org/publication/" class="external-link">Publications</a></li>
                            <li><a href="https://geco-group.org/post/" class="external-link">Blog</a></li>
                        </ul>
</div>

                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
</div>

  


  

  </body>
</html>
